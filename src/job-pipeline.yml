$schema: https://azuremlschemas.azureedge.net/latest/pipelineJob.schema.json
type: pipeline
display_name: test_data_and_train_model
jobs:
  test_data:
    code: test-data
    command: python test_data.py ${{inputs.training_data}}
    environment: azureml:train-env@latest
    compute: azureml:aks-cluster
    inputs:
      training_data:
        type: uri_folder 
        path: azureml://datastores/workspaceblobstore/paths/
    outputs:
      test_data_path: ${{parent.inputs.training_data}}
  register_data:
    command: az ml data create --name diabetes-mlops-data --path ${{inputs.training_data}} --resource-group AI-ML_RG --workspace-name ml-workspace
    environment: azureml:train-env@latest
    compute: azureml:aks-cluster
    inputs:
      training_data: ${{parent.jobs.test_data.outputs.test_data_path}}
    outputs:
      register_data_output:
  train_model:
    code: model
    command: python train.py --training-data ${{inputs.training_data}} --reg-rate ${{inputs.reg_rate}}
    inputs:
      training_data:
        type: uri_folder
        path: ${{parent.jobs.register_data.outputs.register_data_output}}
      reg_rate: 0.01
    environment: azureml:train-env@latest
    compute: azureml:aks-cluster
    experiment_name: mlops-diabetes-training
    description: Train a LR model with YML