$schema: https://azuremlschemas.azureedge.net/latest/pipelineJob.schema.json
type: pipeline
display_name: test_data_and_train_model

inputs:
  test_data_folder:
    type: uri_folder
    path: azureml://datastores/workspaceblobstore/paths/
jobs:
  register_data:
    code: register-data
    command: python register_data_v1.py --data_path ${{inputs.training_data}} --subscription_id ${{secrets.AZURE_SUBSCRIPTION_ID}}
    environment: azureml:train-env:2
    compute: azureml:aks-cluster
    inputs:
      training_data: ${{parent.inputs.test_data_folder}}
    outputs:
      register_data_output:
  train_model:
    code: model
    command: python train.py --training_data ${{inputs.training_data}} --reg_rate ${{inputs.reg_rate}}
    inputs:
      training_data: ${{parent.jobs.register_data.outputs.register_data_output}}
      reg_rate: 0.01
    environment: azureml:train-env:2
    compute: azureml:aks-cluster
    experiment_name: mlops-diabetes-training
    description: Train a LR model with YML